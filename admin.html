

<script>
(async function(){

  const params = new URLSearchParams(location.search);
  const token = params.get("token");

  if(!token){
    document.body.innerHTML = "â›” Access denied";
    throw new Error("No token");
  }

  // ğŸ” device fingerprint
  const raw =
    navigator.userAgent +
    screen.width +
    screen.height +
    navigator.language;

  const hashBuffer = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(raw)
  );

  const deviceId = Array.from(new Uint8Array(hashBuffer))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");

  const lockKey = "posko_device_lock_" + token;
  const locked = localStorage.getItem(lockKey);

  // ğŸ”“ first time â†’ lock
  if(!locked){
    localStorage.setItem(lockKey, deviceId);
    console.log("âœ… Token locked to this device");
    return;
  }

  // âŒ ibang device
  if(locked !== deviceId){
    document.body.innerHTML =
      "â›” This token is already locked to another device";
    throw new Error("Token used elsewhere");
  }

  // âœ… same device
  console.log("âœ… Same device access");

})();
</script>
