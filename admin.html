<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Access</title>
</head>
<body>

<h3>Checking admin access‚Ä¶</h3>

<script>
(async function(){

  /* ===============================
     CONFIG
  =============================== */
  const VALID_TOKEN = "ADMIN123"; // üîë token sa link
  const ADMIN_PIN   = "2468";     // üîê iisang PIN lang
  const PIN_LOCK_KEY = "posko_pin_locked_device"; // huwag galawin

  /* ===============================
     TOKEN CHECK
  =============================== */
  const params = new URLSearchParams(location.search);
  const token = params.get("token");

  if(token !== VALID_TOKEN){
    document.body.innerHTML = "‚õî Invalid admin link";
    return;
  }

  /* ===============================
     DEVICE FINGERPRINT
  =============================== */
  const raw =
    navigator.userAgent +
    screen.width +
    screen.height +
    navigator.language;

  const hashBuffer = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(raw)
  );

  const deviceId = Array.from(new Uint8Array(hashBuffer))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");

  const lockedDevice = localStorage.getItem(PIN_LOCK_KEY);

  /* ===============================
     FIRST DEVICE ‚Üí LOCK PIN
  =============================== */
  if(!lockedDevice){
    const pinInput = prompt("üîê Enter Admin PIN:");
    if(pinInput === null){
      document.body.innerHTML = "‚õî PIN cancelled";
      return;
    }

    if(pinInput.trim() !== ADMIN_PIN){
      document.body.innerHTML = "‚õî WRONG PIN";
      return;
    }

    // üîí lock PIN to this device
    localStorage.setItem(PIN_LOCK_KEY, deviceId);
    window.location.href = "./index.html";
    return;
  }

  /* ===============================
     OTHER DEVICES ‚Üí BLOCK
  =============================== */
  if(lockedDevice !== deviceId){
    document.body.innerHTML =
      "‚õî This PIN is already locked to another device";
    return;
  }

  /* ===============================
     SAME DEVICE ‚Üí ALLOW
  =============================== */
  window.location.href = "./index.html";

})();
</script>

</body>
</html>
